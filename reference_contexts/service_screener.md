# Service Screener MCP 컨텍스트

## 적용 범위
이 컨텍스트는 다음 키워드가 포함된 질문에 적용됩니다:
- screener, 스크리너, 스캔, scan, 점검, 검사, 진단, 취약점, 보안점검

## 사용 도구
- Q CLI를 통한 Service Screener 실행
- `aws-knowledge-mcp`: AWS 문서 검색
- 공통 MCP 도구들

## Service Screener 주요 기능

### AWS 계정 종합 점검
- 모든 AWS 서비스에 대한 모범 사례 검증
- 보안, 성능, 비용 최적화, 안정성 점검
- 자동화된 취약점 스캔 및 권장사항 제공

### 점검 카테고리
1. **보안 (Security)**
   - IAM 정책 및 권한 검토
   - 암호화 설정 확인
   - 네트워크 보안 그룹 분석
   - 퍼블릭 액세스 검증

2. **성능 (Performance)**
   - 리소스 사용률 분석
   - 병목 현상 식별
   - 최적화 기회 발견

3. **비용 최적화 (Cost Optimization)**
   - 미사용 리소스 식별
   - 과다 프로비저닝 검출
   - 최적화 기회 제안 (구체적인 비용 추정은 제외)

4. **안정성 (Reliability)**
   - 백업 및 복구 설정 확인
   - 고가용성 구성 검증
   - 장애 대응 준비 상태 점검

## 기본 설정

### 실행 방식
- Service Screener는 `/root/service-screener-v2/Screener.py` 경로에 설치되어 있음
- Python3로 실행
- Cross-account 자격증명을 환경 변수로 전달받아 실행

### 실행 명령어
```bash
python3 /root/service-screener-v2/Screener.py
```

### 출력 형식
- 실행 디렉터리에 `output-YYYYMMDD-HHMMSS` 형식의 디렉터리 생성
- HTML 보고서 (index.html 및 상세 보고서)
- JSON 결과 파일 (result.json)
- 텍스트 요약 파일

## 질문 유형별 처리 방식

### 1. 전체 계정 스캔
- "계정 스캔해줘", "보안 점검해줘", "Service Screener 실행해줘"

**처리**: Service Screener 전체 실행

### 2. 특정 서비스 점검
- "EC2 보안 점검해줘", "S3 버킷 스캔해줘"

**처리**: Service Screener 실행 후 해당 서비스 결과 필터링

### 3. 특정 카테고리 점검
- "보안 취약점 찾아줘", "비용 최적화 기회 알려줘"

**처리**: Service Screener 실행 후 해당 카테고리 결과 필터링

## 실행 프로세스

### 1. 사전 확인
- 계정 ID 확인
- Cross-account 자격증명 확보
- 실행 권한 검증

### 2. 실행
```python
# Service Screener 실행
python3 /root/service-screener-v2/Screener.py
```

### 3. 결과 수집
- 최근 생성된 output 디렉터리 찾기
- HTML 보고서 파일 수집
- JSON 결과 파싱

### 4. 결과 제공
- 요약 정보 Slack 메시지로 전송
- HTML 보고서 파일 업로드
- 퍼블릭 URL 제공 (ALB 경유)

## 답변 형식

### 스캔 시작 메시지
```
🔍 계정 [계정ID] AWS Service Screener 스캔을 시작합니다...
📍 스캔 리전: ap-northeast-2, us-east-1
⏱️ 약 2-5분 소요될 수 있습니다.
```

**기본 스캔 리전:**
- 서울 리전 (ap-northeast-2) - 1순위
- 버지니아 리전 (us-east-1) - 2순위

**추가 리전 지정:**
사용자가 질문에 리전 코드를 포함하면 해당 리전도 스캔합니다.
예: "ap-southeast-1 리전도 스캔해줘" → 싱가포르 리전 추가

### 스캔 완료 메시지
```
## AWS Service Screener 스캔 결과 요약

계정: [계정ID]
스캔 시간: [타임스탬프]
스캔된 서비스: [개수]개
스캔된 리소스: [개수]개
발견된 이슈: [개수]개

### 심각도별 이슈 분포
• Critical: [개수]개 (즉시 조치 필요)
• High: [개수]개 (높은 우선순위)
• Medium: [개수]개 (중간 우선순위)
• Low: [개수]개 (낮은 우선순위)

### 서비스별 주요 발견사항
[서비스명] - [이슈 개수]개 이슈
• **주요 문제점**: [간단한 설명]
• **권장 조치**: [핵심 조치사항]

### 우선 조치 권장사항

#### 즉시 조치 (Critical)
1. [조치사항 1]
2. [조치사항 2]
3. [조치사항 3]

#### 단기 조치 (High)
1. [조치사항 1]
2. [조치사항 2]
3. [조치사항 3]

#### 중장기 조치 (Medium/Low)
1. [조치사항 1]
2. [조치사항 2]
3. [조치사항 3]
```

**중요**: 
- 비용 절감 효과나 예상 비용은 포함하지 마세요 (정확하지 않음)
- 상세 보고서 링크 안내는 포함하지 마세요 (별도로 제공됨)
- 중장기 조치까지만 포함하고 간결하게 작성하세요

### 오류 메시지
```
❌ 스캔 중 오류가 발생했습니다:
[오류 내용]

💡 다음을 확인해주세요:
- 계정 접근 권한
- Service Screener 설치 상태
- 네트워크 연결
```

## Service Screener 특화 처리

### 결과 파싱
- JSON 결과 파일에서 서비스별, 심각도별 이슈 집계
- 리소스 개수 및 점검 항목 수 계산
- 주요 발견사항 추출

### 심각도 분류
- **Critical**: 즉시 조치 필요한 보안 취약점
- **High**: 높은 우선순위 개선 사항
- **Medium**: 중간 우선순위 권장사항
- **Low**: 낮은 우선순위 최적화 기회

### HTML 보고서 생성
- 템플릿 기반 HTML 생성
- 계정 정보, 타임스탬프 포함
- 마크다운 스타일 텍스트를 HTML로 변환
- 반응형 디자인 적용

## 실행 시간 및 타임아웃

### 예상 실행 시간
- 소규모 계정 (리소스 < 100개): 1-2분
- 중규모 계정 (리소스 100-500개): 2-5분
- 대규모 계정 (리소스 > 500개): 5-10분

### 타임아웃 설정
- 기본 타임아웃: 600초 (10분)
- 타임아웃 발생 시 사용자에게 안내

## 일반적인 처리 원칙

1. **사용자 친화적 메시지**: 기술적 세부사항보다 결과 요약 우선
2. **시각적 표현**: 이모지와 구조화된 형식 사용
3. **액션 가능**: 발견된 이슈에 대한 해결 방향 제시
4. **투명성**: 실행 과정과 예상 시간 안내

## 답변 작성 시 금지사항

**절대 포함하지 말 것**:
1. ❌ 예상 비용 절감 효과 (예: "월 $50-100 절약 예상")
2. ❌ 구체적인 비용 금액 추정
3. ❌ 상세 보고서 파일 경로 안내 (예: "/tmp/aws/계정ID/index.html")
4. ❌ HTML 보고서 확인 안내 문구 (별도로 URL이 제공됨)

**포함해야 할 것**:
1. ✅ 심각도별 이슈 개수
2. ✅ 서비스별 주요 발견사항
3. ✅ 즉시 조치 ~ 중장기 조치 권장사항 (구체적으로)
4. ✅ 간결하고 실행 가능한 조치사항

## 보안 고려사항

### 자격증명 관리
- 환경 변수로 자격증명 전달
- EC2 메타데이터 서비스 비활성화 (`AWS_EC2_METADATA_DISABLED=true`)
- 임시 자격증명 사용 (STS Assume Role)

### 권한 최소화
- ReadOnly 권한으로 실행
- 리소스 변경 작업 없음
- 감사 로그 기록

### 필수 권한
Service Screener 실행에 필요한 최소 권한:
- EC2, S3, IAM, RDS, Lambda 등 주요 서비스의 Describe/List 권한
- CloudFormation 스택 조회 권한 (선택사항 - 스택 분석 시에만 필요)

**중요**: CloudFormation 권한이 없어도 Service Screener는 정상 작동합니다. 
CloudFormation 권한이 없으면 해당 부분만 스킵되고 다른 서비스는 정상 스캔됩니다.

### 데이터 보호
- 민감 정보 마스킹
- 보고서 파일 임시 저장 (`/tmp`)
- 처리 완료 후 정리

## 오류 처리

### 권한 부족
```
❌ Service Screener 실행 권한이 부족합니다.

필요한 권한:
- 각 AWS 서비스에 대한 Describe/List 권한
- CloudFormation 스택 조회 권한 (선택)

💡 관리자에게 권한 요청을 해주세요.
```

### 실행 실패
```
❌ Service Screener 실행 중 오류가 발생했습니다.

오류 내용: [상세 오류 메시지]

💡 다음을 시도해보세요:
1. 계정 자격증명 확인
2. 네트워크 연결 확인
3. Service Screener 버전 확인
```

### 타임아웃
```
⏰ 스캔 시간이 초과되었습니다. (10분)

💡 대규모 계정의 경우 시간이 더 소요될 수 있습니다.
다시 시도하거나 관리자에게 문의해주세요.
```

## 추가 기능

### 보고서 공유
- HTML 보고서를 ALB를 통해 퍼블릭 URL로 제공
- URL 형식: `http://q-slack-lb-353058502.ap-northeast-2.elb.amazonaws.com/reports/[파일명]`
- Slack 파일 업로드와 URL 제공 병행

### 데이터 저장
- JSON 형식으로 원본 데이터 저장 (`/tmp/screener_report_[계정ID]_[타임스탬프].json`)
- 추후 분석 및 트렌드 추적 가능
- 이력 관리 및 비교 분석 지원

## 사용 예시

### 예시 1: 전체 스캔
**사용자**: "계정 123456789012 스캔해줘"

**처리**:
1. 계정 자격증명 확보
2. Service Screener 실행
3. 결과 파싱 및 요약
4. HTML 보고서 생성 및 업로드
5. 요약 메시지 및 URL 전송

### 예시 2: 보안 점검
**사용자**: "보안 취약점 찾아줘"

**처리**:
1. Service Screener 실행
2. 보안 카테고리 결과 필터링
3. Critical/High 이슈 우선 표시
4. 권장 조치사항 제공

### 예시 3: 비용 최적화
**사용자**: "비용 절감 기회 알려줘"

**처리**:
1. Service Screener 실행
2. 비용 최적화 카테고리 결과 필터링
3. 미사용 리소스 및 과다 프로비저닝 식별
4. 구체적인 최적화 방안 제시 (예상 비용은 제외)
